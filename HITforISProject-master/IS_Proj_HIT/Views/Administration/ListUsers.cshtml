@using Microsoft.AspNetCore.Identity;
@*@model IEnumerable<IdentityUser>*@
@model IList<IdentityUser>
@{
    ViewData["Title"] = "ListUsers";
}

<h1>ListUsers</h1>
<a asp-action="Index" class="btn btn-outline-primary">Return To Role List</a>


    @*<div class="card-body">*@
    @using (Html.BeginForm("DeleteBatch", "Administration", FormMethod.Post))
    {<div class="card">
    <button type="submit" value="Delete" class="btn btn-sm btn-danger rounded-0" onclick="return confirm('Are you sure?')"><i class="fa fa-trash-o"></i> Delete</button>

    <input type="button" id="delete"
           value="Delete Selected Customers" />

    <table class="table table-striped">
        <thead>
            <tr>
                <th>
                    @*@Html.DisplayNameFor(model => model.)*@
                    Name
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.UserId)*@
                    ID
                </th>

                <th>
                </th>
                <th>

                    <input type="checkbox" name="userIdsToDelete" id="checkAll" value="@Model." style="width: 30px; height: 30px; text-align:center; vertical-align:middle;" /> Select All
                </th>

            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>

                    <td>

                        @Html.DisplayFor(modelItem => item.UserName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Id)
                    </td>

                    <td>

                        <a asp-action="EditUsersInRole" asp-route-id="@item">Edit</a> |
                        <a asp-action="Details" asp-route-id="@item">Details</a> |
                        <a asp-action="DeleteUser" asp-route-id="@item.Id"
                           onclick="return confirm('Are you sure you want to delete user : @item.UserName ?')">Delete</a>

                    </td>
                    <td>
                        <input type="hidden" asp-for="@item.Id" />
                        <input type="checkbox" class="checkBox" id="id" name="@item.Id" value="@item.Id" style="width: 30px; height: 30px; text-align:center; vertical-align:middle;" />
                    </td>
                </tr>
            }
            @*@for (int i = 0; i < Model.Count(); i++)
                {
                    <tr id="userRoleTableRow">

                        <td style="display:none"><input asp-for="@Model[i].UserName" /></td>
                        <td style="display:none"> <input asp-for="@Model[i].Id"></td>

                        <td>@Model[i].UserName</td>
                        <td>@Model[i].Id</td>
                        <td>
                            <input type="checkbox" class="checkBox" id="userIdsToDelete" name="@Model[i].Id" value="@Model[i].Id" style="width: 30px; height: 30px; text-align:center; vertical-align:middle;" />

                           <input asp-for="@Model[i].Id" class="form-check-input ml-4 justify-center" style="width: 30px; height: 25px; margin-left: 38px;" />
                        </td>
                    </tr>
                }*@
        </tbody>
    </table>
</div>
    }


    @*</div>*@
    @*<div class="card-footer">
            <a asp-action="EditUsersInRole" asp-controller="Administration" asp-route-roleId="@Model"
               class="btn btn-primary text-white" style="width:auto">Add or Remove Users</a>
        </div>*@



@section scripts{
    <script type="text/javascript">


        $(document).ready(function () {

            $("#checkAll").click(function () {
                $(".checkBox").prop('checked',
                    $(this).prop('checked'));
            });

            $("#delete").click(function () {
                var selectedIDs = new Array();
                $('input:checkbox.checkBox').each(function () {
                    if ($(this).prop('checked')) {
                        selectedIDs.push($(this).val());
                    }
                });

                var options = {};
                options.url = "/administration/deletebatch";
                options.type = "POST";
                options.data = JSON.stringify(selectedIDs);
                options.contentType = "application/json";
                options.dataType = "json";
                options.success = function (msg) {
                    alert(msg);
                };
                console.log(options)
                options.error = function () {
                    alert("Error while deleting the records!");
                    console.log(this.error)
                };
                $.ajax(options);

                

            });
        });













        //$(document).ready(function () {
        //    $("#selectAll").click(function () {
        //        $("#input[type=checkbox]").prop('checked', $(this).prop('checked'));

        //    });

        //    $("input[type=checkbox]").click(function () {
        //        if (!$(this).prop("checked")) {
        //            $("#selectAll").prop("checked", false);
        //        }
        //    });
        //})
    </script>
}
